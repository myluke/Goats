下面是一个基于 **Mountain Goats** 规则、面向「网页版可玩」的简化 PRD 草案，你可以直接拿去扩展/拆任务。

---

## 1. 产品概述

**产品名称**：Mountain Goats（登山山羊）网页版
**类型**：2–4 人回合制掷骰桌游（支持同屏/在线轮流操作）
**平台**：Web（桌面浏览器优先，兼容移动端）

**核心一句话**：
玩家通过掷 4 颗骰子、组合点数让自己的山羊爬上 6 座不同高度的山，抢占山顶拿分，同时把对手从山顶挤下去，并尽量从每座山都拿到分数以获取额外奖励。([Yucata][1])

---

## 2. 目标 & 范围

### 2.1 MVP 目标

* 实现 **基础版 Mountain Goats 完整规则**（不含扩展 Big Mountain / Green Valley）。
* 支持 **2–4 名玩家** 在同一屏幕上轮流操作（Hotseat，本地多人），方便语音通话时一起玩。
* 提供 **清晰的规则引导** 和 **自动记分/结算**。

> 扩展包与在线匹配/房间系统列为 V2+ 需求。

### 2.2 不在本次范围内（可选的未来版本）

* 账号系统、战绩统计、排行榜。
* 真·在线对战（房间、实时同步、断线重连）。
* 扩展包：

  * Big Mountain 扩展（大山）([Yucata][1])
  * Green Valley 扩展（绿谷）([Yucata][1])

---

## 3. 游戏规则需求（转成可实现逻辑）

### 3.1 组件建模

1. **山（Mountain）**

   * 共 6 座山：编号 5、6、7、8、9、10。([Yucata][1])
   * 每座山有若干格子组成“山路”，顶部是“山顶格”。

2. **分数筹码（Point Tokens）**

   * 每座山有一叠对应分数的筹码（具体数量可以直接按规则预设数据表）。([Yucata][1])
   * 当玩家的羊**抵达山顶或已经在山顶再触发移动**时，从该山的筹码堆中拿 1 枚。([Yucata][1])

3. **奖励筹码（Bonus Tokens）**

   * 4 枚奖励筹码，分值为 15、12、9、6。([Yucata][1])
   * 用于奖励「集齐六山分数」的玩家。

4. **骰子（Dice）**

   * 4 颗六面骰，值为 1–6。([Yucata][1])

5. **山羊棋子（Goats）**

   * 每名玩家 6 只山羊（每座山最多 1 只自己的羊在山路上/山顶）。([Yucata][1])

### 3.2 初始设置（Setup）

* 选择玩家人数 N（2–4）。
* 为每位玩家分配一个颜色/头像和名称（可输入昵称）。
* 将 6 座山按 5 → 10 的顺序横向展示。
* 在每座山顶放置对应的分数筹码堆（按规则配置数量）。([Yucata][1])
* 摆放奖励筹码（4 枚，按分值从大到小排列）。
* 每位玩家自动在 **每座山的山脚** 放一个山羊（位置 index=0）。

> 可选：2/3 人局要减少每山上的筹码数量（规则里有说明，2 人局每山去掉 2 个筹码、3 人局每山去掉 1 个筹码）。([Yucata][1])

### 3.3 回合流程（Turn Flow）

每回合由当前玩家依次执行：

1. **掷骰阶段**

   * 系统随机投掷 4 颗骰子，显示结果（例如 [1,1,3,5]）。([Yucata][1])
   * **特殊规则：多个 1 的处理**

     * 如果掷出超过 1 个「1」，玩家可以将多出的那些 1 改成任意想要的点数（每个可以选不同点数），只保留 1 个 1 不变。([Yucata][1])
     * 前端需提供交互（点击额外的 1 弹出点数选择）。

2. **分组阶段（Grouping）**

   * 玩家将 4 颗骰子分成任意若干组，每个骰子必须且只能属于 1 组。

   * 系统实时计算每组点数之和。

   * **只要和在 5–10 之间的组才有效**，对应那座山的山羊向上移动一格；其他和（<5 或 >10）则不会带来移动。([Yucata][1])

   > 例如：[2,2,2,4] → 玩家可以分为 (2+2+2=6) 和 (4=4)，只会移动 6 号山的羊一格，4 号无效。

3. **移动阶段（Move Goats）**

   * 对每一个合法的分组（和 ∈ [5,10]）：

     1. 找到该玩家在对应山上的羊。
     2. 若羊不在山上（理论上不会发生，因为起始就有），则从山脚“召唤”一只新羊。
     3. 羊的位置 +1（往山顶方向）。
     4. 若因此**刚好到达山顶格**：

        * 从该山的分数筹码堆**拿 1 枚**给该玩家。([Yucata][1])
        * 如果山顶上已有其他玩家的羊，则将那只羊送回该山脚。
     5. 如果羊**已经在山顶**且本次又得到一次“移动机会”：

        * 羊保持在山顶不动；
        * 玩家仍然从该山的分数筹码堆拿 1 枚分数。([Yucata][1])

   * 山路中途可以有多个羊在同一格；只有山顶格限制**最多 1 只羊**。([Yucata][1])

4. **奖励筹码判定（Set Bonus Check）**

   * 每回合结束时，检查当前玩家是否满足：

     * 从每一座山（5–10）都至少持有 1 枚该山的分数筹码（按「山类型」判断，不是只看数量）。([Yucata][1])
   * 若满足且还有奖励筹码：

     * 玩家获得当前可用奖励筹码中**分值最高的一枚**；
     * 该玩家此后如果再次集齐一套新的「六山筹码」（例如某山已消耗一枚，仍然至少一枚），可再拿下一枚奖励筹码。([Yucata][1])

5. **回合结束**

   * 切换到下一个玩家，重复上述流程。

### 3.4 结束条件与胜负判定

**结束触发条件（满足任一）：**([Yucata][1])

1. 所有奖励筹码被拿光；
2. 有 3 座山的分数筹码堆为空（该山不再产分数）。

触发后，继续轮转直至所有玩家出手次数相同（通常回合到达起始玩家的前一位结束）。

**计分与胜负：**

1. 每位玩家将所有：

   * 分数筹码（各山上的）；
   * 奖励筹码；
     上面的数字累加，总和即为总分。([Yucata][1])
2. 总分最高者获胜。
3. 若平分，则按以下顺序依次比较：([Yucata][1])

   * 站在山顶上的羊数量多者获胜；
   * 若仍然平手，则比最高编号山（10 > 9 > ... > 5）上是否有羊站顶，有则优先。

---

## 4. 功能需求（Feature Requirements）

### 4.1 对局管理

* FR-1：创建本地对局（选择 2–4 名玩家，输入昵称，选颜色）。
* FR-2：保存当前对局状态到浏览器本地（LocalStorage），支持刷新后继续。
* FR-3：支持中途查看规则说明（弹窗/侧边栏）。

> 如果你将来做在线房间：可另外设计房间号、WebSocket 同步等，这里先不写死。

### 4.2 玩家与状态

* FR-10：玩家属性：`id / name / color / score / goatPositions / tokensByMountain / bonusTokens`。
* FR-11：系统实时显示当前玩家头像/昵称和所持分数。
* FR-12：支持简单的玩家顺序显示（顶部或侧边栏列表）。

### 4.3 掷骰 & 分组交互

* FR-20：点击「掷骰」按钮 → 动画展示 4 颗骰子滚动 → 停止后显示点数。
* FR-21：如果出现多个 1，UI 显示提示并高亮多余的 1，玩家可以点击每个 1 选择要变成的点数（1–6）。
* FR-22：玩家可以通过**拖拽 / 点击**将骰子分配到多个“组槽”中，每个组槽显示当前组的和。
* FR-23：前端实时提示哪些组会触发哪座山的移动（例如在 6 号山旁边显示“+1”箭头）。
* FR-24：确认分组后，锁定本轮骰子结果，进入移动阶段（后台根据分组计算移动）。

### 4.4 山羊移动 & 山顶逻辑

* FR-30：对每个合法组（和在 5–10）执行一次「移动山羊」逻辑。
* FR-31：若羊到达山顶并且山顶有敌方羊，敌方羊被动画“滚下山”，位置重置到山脚。
* FR-32：每次拿到分数筹码时，在玩家面板上以动画+数字增加显示。

### 4.5 奖励筹码逻辑

* FR-40：维护玩家按山类型的筹码记录。
* FR-41：每回合结束自动检查是否集齐 6 种山的筹码，如是则发放最高分奖励筹码并播提示动画。
* FR-42：支持玩家多次拿奖励筹码（只要规则满足）。

### 4.6 结束与结算

* FR-50：每次筹码被拿走后检查：

  * 奖励筹码是否用完；
  * 是否有 3 座山的筹码堆空。
* FR-51：触发结束条件后，顶部显示“最后 X 轮/最后轮次”提示，并保证所有玩家行动次数相同。
* FR-52：游戏结束后展示**结算面板**：

  * 每位玩家：各山筹码明细 + 奖励筹码 + 总分；
  * 显示冠军标记，如有平手应用 tie-break 逻辑并展示原因（例如“山顶羊更多”）。
* FR-53：提供“重新开始一局”的按钮，复用玩家设置。

---

## 5. UI / UX 需求

### 5.1 布局（建议）

* 桌面端：

  * 中央：6 座山水平排布，每座山竖向显示山路格子、山顶筹码堆、山羊 meeple。
  * 底部：当前玩家的骰子区域（4 颗骰子、分组区、操作按钮）。
  * 侧边：玩家列表，显示昵称、得分、奖励筹码、可视化的羊数量。
* 移动端：

  * 山区可左右滑动查看全部 6 座山；
  * 骰子区域固定在底部；
  * 玩家列表可折叠菜单。

### 5.2 交互细节

* 掷骰和山羊移动必须有基础动画（轻量，也可以用 CSS/transform）。
* 当某玩家被从山顶挤下时，播放一个明显但不烦人的动画/提示。
* 鼠标 hover / 触摸长按山顶筹码堆，可显示该山目前剩余的筹码数量。
* 出现规则复杂行为时（例如多个组同时登顶），可以有简短的文字 log（“A 登上 9 号山顶，B 被挤下”）。

### 5.3 新手引导

* 首次进入建议提供：

  * 简洁版规则引导（多步气泡/步骤提示）；
  * 或一个“演示轮”，系统帮玩家自动分组并解释。

---

## 6. 技术与非功能性需求（可根据你团队情况调整）

* NF-1：前端框架可选 Vue3 + TypeScript + TailwindCSS + Shadcn 风格，状态管理建议集中维护完整 `gameState`（方便回放和撤销调试）。
* NF-2：兼容主流桌面浏览器（Chrome / Safari / Edge），移动端可使用响应式布局。
* NF-3：单局玩家数 ≤ 4，状态量小，对性能要求不高，但要保持动画流畅。
* NF-4：所有规则逻辑（掷骰、分组、移动、结算）应与 UI 解耦（可单独写成纯函数模块，方便未来对接在线对战或 AI）。

---

